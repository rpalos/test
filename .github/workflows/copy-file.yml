name: 'Copy File if Different'
on:
  push:
    branches:
      - main
jobs:
  check-and-copy:
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout main branch'
        uses: actions/checkout@v2
        with:
          ref: main
      - name: 'Checkout main-test branch'
        uses: actions/checkout@v2
        with:
          ref: main-test
          path: main-test
      - name: 'Compare files'
        id: compare
        run: |
          if ! cmp -s path/to/templates/collection.novedades-hombre-D2022.json main-test/path/to/templates/collection.novedades-hombre-D2022.json; then
            echo "Files are different"
            echo "copy=true" >> $GITHUB_ENV
            git branch
            git config --global --list
          else
            echo "Files are the same"
            echo "copy=false" >> $GITHUB_ENV
          fi
      - name: 'Copy file if different'
        if: env.copy == 'true'
        uses: planetoftheweb/copy-to-branches@v1
        env:
          key: main
          branches: main-test
          files: templates/collection.novedades-hombre-D2022.json
      - name: 'Config Git'
        if: env.copy == 'true'
        run: |
          git config --local user.email rpalos@scalperscompany.com
          git config --local user.name Rafael Palos
          git config --local user.password .Bormujos2024
      - name: 'Checkout main-test branch'
        uses: actions/checkout@v2
        with:
          ref: main-test
      - name: 'Commit and push changes'
        if: env.copy == 'true'
        run: |
          git branch
          git init
          git status
          # git add templates/collection.novedades-hombre-D2022.json
          # git status
          # git commit -m "Update file from main branch"
          # git push
